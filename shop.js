const TELEGRAM='https://t.me/Genesisacc';const STORAGE_KEY='rs_products_v1';const CART_KEY='rs_cart_v1';function defaultProducts(){return [{id:'p1',title:'1000 Robux',price:149,img:'',desc:'Пакет 1000 Robux (демо)'},{id:'p2',title:'5000 Robux',price:599,img:'',desc:'Пакет 5000 Robux (демо)'},{id:'p3',title:'VIP Кейс',price:999,img:'',desc:'Кейс с шансом на редкие вещи'}];}function loadProducts(){const r=localStorage.getItem(STORAGE_KEY);if(r)return JSON.parse(r);const d=defaultProducts();localStorage.setItem(STORAGE_KEY,JSON.stringify(d));return d;}function saveProducts(l){localStorage.setItem(STORAGE_KEY,JSON.stringify(l));}function renderProducts(){const list=loadProducts();const wrap=document.getElementById('products');wrap.innerHTML='';list.forEach(p=>{const card=document.createElement('div');card.className='card';card.innerHTML=`<img src="${p.img||'https://i.imgur.com/8Km9tLL.png'}"><div class="title">${p.title}</div><div class="small">${p.desc}</div><div style="margin-top:8px"><strong>${p.price} ₽</strong></div><div style="margin-top:10px"><button class="btn" data-id="${p.id}" data-act="open">Купить</button></div>`;wrap.appendChild(card);});}function openModal(id){const products=loadProducts();const p=products.find(x=>x.id===id);if(!p)return;document.getElementById('pmContent').innerHTML=`<h3>${p.title}</h3><p>${p.desc}</p><p><strong>${p.price} ₽</strong></p>`;document.getElementById('addToCart').dataset.id=p.id;document.getElementById('prodModal').classList.remove('hidden');}function closeModal(){document.getElementById('prodModal').classList.add('hidden');}function loadCart(){const r=localStorage.getItem(CART_KEY);return r?JSON.parse(r):[]}function saveCart(c){localStorage.setItem(CART_KEY,JSON.stringify(c));renderCart();}function renderCart(){const c=loadCart();document.getElementById('cartCount').textContent=c.reduce((s,i)=>s+i.qty,0);const wrap=document.getElementById('cartItems');if(!wrap)return;wrap.innerHTML='';let total=0;c.forEach(item=>{const div=document.createElement('div');div.className='item';div.innerHTML=`<div>${item.title} × ${item.qty}</div><div>${item.price*item.qty} ₽</div>`;wrap.appendChild(div);total+=item.price*item.qty;});document.getElementById('cartTotal').textContent=total;}function addToCart(id){const products=loadProducts();const p=products.find(x=>x.id===id);if(!p)return;const c=loadCart();const exists=c.find(x=>x.id===id);if(exists)exists.qty++;else c.push({id:p.id,title:p.title,price:p.price,qty:1});saveCart(c);closeModal();}function checkoutTelegram(){const c=loadCart();if(c.length===0){alert('Корзина пуста');return;}let msg='Новый заказ%0A';c.forEach(it=>msg+=encodeURIComponent(it.title+' x'+it.qty+' — '+it.price+' ₽')+'%0A');const total=c.reduce((s,i)=>s+i.qty*i.price,0);msg+='%0A'+encodeURIComponent('Итог: '+total+' ₽');const url=TELEGRAM+'?start='+msg;window.open(url,'_blank');}document.addEventListener('click',function(e){if(e.target.dataset&&e.target.dataset.act==='open')openModal(e.target.dataset.id);if(e.target.id==='closeModal')closeModal();if(e.target.id==='addToCart')addToCart(e.target.dataset.id);if(e.target.id==='cartBtn')document.getElementById('cart').classList.toggle('hidden');if(e.target.id==='checkout')checkoutTelegram();if(e.target.id==='clearCart'){localStorage.removeItem(CART_KEY);renderCart();}});renderProducts();renderCart();document.getElementById('closeModal')?.addEventListener('click',closeModal);