const STORAGE_KEY='rs_products_v1';const ADMIN_USER='admin';const ADMIN_PASS='1234';function loadProducts(){const r=localStorage.getItem(STORAGE_KEY);return r?JSON.parse(r):[];}function saveProducts(list){localStorage.setItem(STORAGE_KEY,JSON.stringify(list));renderProductList();}function renderProductList(){const list=loadProducts();const wrap=document.getElementById('productList');wrap.innerHTML='';list.forEach(p=>{const row=document.createElement('div');row.className='product-row';row.innerHTML=`<img src="${p.img||'https://i.imgur.com/8Km9tLL.png'}" width="64"><div style="flex:1"><strong>${p.title}</strong><div class="small">${p.price} ₽</div></div><div><button class="btn" data-id="${p.id}" data-act="edit">Редакт</button> <button class="btn ghost" data-id="${p.id}" data-act="del">Удалить</button></div>`;wrap.appendChild(row);});}function addProduct(){const t=document.getElementById('pTitle').value.trim();const pr=Number(document.getElementById('pPrice').value);const img=document.getElementById('pImage').value.trim();if(!t||!pr)return alert('Введите название и цену');const list=loadProducts();const id='p'+Date.now();list.push({id,title:t,price:pr,img,desc:''});saveProducts(list);document.getElementById('pTitle').value='';document.getElementById('pPrice').value='';document.getElementById('pImage').value='';}function doLogin(){const u=document.getElementById('adminUser').value.trim();const p=document.getElementById('adminPass').value;if(u===ADMIN_USER&&p===ADMIN_PASS){document.getElementById('adminArea').style.display='block';document.getElementById('doLogin').style.display='none';document.getElementById('doLogout').style.display='inline-block';document.getElementById('loginStatus').textContent='Вошли как админ';renderProductList();}else alert('Неверный логин или пароль');}function doLogout(){document.getElementById('adminArea').style.display='none';document.getElementById('doLogin').style.display='inline-block';document.getElementById('doLogout').style.display='none';document.getElementById('loginStatus').textContent='';}document.addEventListener('click',function(e){if(e.target.id==='addProduct')addProduct();if(e.target.id==='doLogin')doLogin();if(e.target.id==='doLogout')doLogout();if(e.target.dataset&&e.target.dataset.act==='del'){const id=e.target.dataset.id;if(confirm('Удалить товар?')){const list=loadProducts().filter(x=>x.id!==id);saveProducts(list);}}if(e.target.dataset&&e.target.dataset.act==='edit'){const id=e.target.dataset.id;const list=loadProducts();const p=list.find(x=>x.id===id);const newTitle=prompt('Новое название',p.title);if(newTitle!==null){p.title=newTitle;saveProducts(list);}}if(e.target.id==='exportBtn'){const list=loadProducts();const blob=new Blob([JSON.stringify(list,null,2)],{type:'application/json'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='products.json';a.click();URL.revokeObjectURL(url);}if(e.target.id==='importFile'){const f=e.target.files[0];if(!f)return;const reader=new FileReader();reader.onload=()=>{try{const arr=JSON.parse(reader.result);localStorage.setItem(STORAGE_KEY,JSON.stringify(arr));renderProductList();alert('Импортирован');}catch(err){alert('Ошибка импорта');}};reader.readAsText(f);}});
// init default
if(!localStorage.getItem(STORAGE_KEY)){localStorage.setItem(STORAGE_KEY,JSON.stringify([{id:'p1',title:'1000 Robux',price:149,img:'',desc:'Пакет 1000 Robux'},{id:'p2',title:'5000 Robux',price:599,img:'',desc:'Пакет 5000 Robux'},{id:'p3',title:'VIP Кейс',price:999,img:'',desc:'Кейс VIP'}]));}
renderProductList();